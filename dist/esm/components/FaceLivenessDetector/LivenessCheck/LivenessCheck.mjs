import*as e from"react";import{Flex as t,Text as r,Button as s,View as i}from"@aws-amplify/ui-react";import"../service/machine/index.mjs";import"../service/types/liveness.mjs";import{LivenessErrorState as o}from"../service/types/error.mjs";import"tslib";import"@tensorflow/tfjs-core";import"@tensorflow-models/blazeface";import"@tensorflow/tfjs-backend-wasm";import"@tensorflow/tfjs-backend-cpu";import"@aws-amplify/core";import"../service/utils/liveness.mjs";import"../service/utils/streamProvider.mjs";import"../service/utils/freshnessColorDisplay.mjs";import{LivenessCameraModule as a}from"./LivenessCameraModule.mjs";import{useLivenessActor as n}from"../hooks/useLivenessActor.mjs";import{useLivenessSelector as m,createLivenessSelector as c}from"../hooks/useLivenessSelector.mjs";import"@aws-amplify/ui";import{isMobileScreen as p,getLandscapeMediaQuery as l}from"../utils/device.mjs";import{CancelButton as d}from"../shared/CancelButton.mjs";import{defaultErrorDisplayText as f}from"../displayText.mjs";import{LandscapeErrorModal as u}from"../shared/LandscapeErrorModal.mjs";import{selectErrorState as E}from"../shared/Hint.mjs";import"../types/classNames.mjs";const y="liveness-detector-check",g=c((e=>e.context.isRecordingStopped)),h=({hintDisplayText:c,cameraDisplayText:h,streamDisplayText:x,errorDisplayText:j,components:R})=>{const[T,A]=n(),v=m(E),C=m(g),M=T.matches("permissionDenied"),b=p(),L=()=>{A({type:"RETRY_CAMERA_CHECK"})},{cameraMinSpecificationsHeadingText:k,cameraMinSpecificationsMessageText:D,cameraNotFoundHeadingText:w,cameraNotFoundMessageText:_,retryCameraPermissionsText:N}=h,{cancelLivenessCheckText:S}=x;e.useLayoutEffect((()=>{if(b){const e=e=>{e&&A({type:"MOBILE_LANDSCAPE_WARNING"})},t=l();return e(t.matches),t.addEventListener("change",(t=>{e(t.matches)})),()=>{t.removeEventListener("change",(t=>e(t.matches)))}}}),[b,A]);return e.createElement(t,{direction:"column",position:"relative",testId:y,className:y},(()=>{if(v===o.MOBILE_LANDSCAPE_ERROR){const r=Object.assign(Object.assign({},f),j),{landscapeHeaderText:s,portraitMessageText:i,landscapeMessageText:o,tryAgainText:a}=r;return e.createElement(t,{backgroundColor:"background.primary",direction:"column",textAlign:"center",alignItems:"center",justifyContent:"center",position:"absolute",width:"100%"},e.createElement(u,{header:s,portraitMessage:i,landscapeMessage:o,tryAgainText:a,onRetry:()=>{A({type:"CANCEL"})}}))}return M?e.createElement(t,{backgroundColor:"background.primary",direction:"column",textAlign:"center",alignItems:"center",justifyContent:"center",width:"100%",height:480},e.createElement(r,{fontSize:"large",fontWeight:"bold"},v===o.CAMERA_FRAMERATE_ERROR?k:w),e.createElement(r,{maxWidth:300},v===o.CAMERA_FRAMERATE_ERROR?D:_),e.createElement(s,{variation:"primary",type:"button",onClick:L},N),e.createElement(i,{position:"absolute",top:"medium",right:"medium"},e.createElement(d,{ariaLabel:S}))):e.createElement(a,{isMobileScreen:b,isRecordingStopped:C,streamDisplayText:x,hintDisplayText:c,errorDisplayText:j,components:R})})())};export{h as LivenessCheck};
